#!/bin/sh

SVC=/var/run/s6/services/mssql
UP="false"

i=0
while [ $i -lt 300 ]; do
  # check MSSQL service status
  UP=`s6-svstat -u $SVC`
  if [ "$UP" = "true" ]; then
    # its up, next ..
    break
  fi

  sleep 5
  i=`expr $i + 5`
done

if [ ! "$UP" = "true" ]; then
  echo "WARN: timeout is reached, but MSSQL Server is not up!"
  exit -1
fi

# stop MSSQL service
s6-svc -d $SVC

# change collation
read -p "Enter the collation: " collation

s6-setuidgid mssql /opt/mssql/bin/sqlservr -q${collation}

# startup MSSQL service
s6-svc -u $SVC

exit 0
